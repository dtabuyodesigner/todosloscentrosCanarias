<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Directorio Avanzado de Centros Educativos - Canarias</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .sortable:hover { background-color: #f0f4f8; cursor: pointer; }
        .sort-asc::after { content: ' ▲'; font-size: 0.8em; }
        .sort-desc::after { content: ' ▼'; font-size: 0.8em; }
        #modal-backdrop { background-color: rgba(0,0,0,0.5); }
        .modal-enter { opacity: 0; transform: scale(0.95); }
        .modal-enter-active { opacity: 1; transform: scale(1); }
        .modal-leave-active { opacity: 0; transform: scale(0.95); }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <div class="container mx-auto p-4 md:p-8">
        <header class="bg-white shadow-md rounded-xl p-6 mb-8 text-center">
            <h1 class="text-4xl font-bold text-blue-700">Directorio Avanzado de Centros Educativos</h1>
            <p class="text-gray-500 mt-2">Canarias</p>
        </header>

        <div class="bg-white shadow-md rounded-xl p-6 mb-8">
            <h2 class="text-xl font-semibold mb-4 text-gray-700">Controles de Búsqueda</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                <input type="text" id="search-input" placeholder="Buscar por nombre o código..." class="lg:col-span-1 w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                <select id="filter-isla" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                    <option value="all">Todas las Islas</option>
                </select>
                <select id="filter-municipio" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" disabled>
                    <option value="all">Todos los Municipios</option>
                </select>
                <select id="filter-zona" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" disabled>
                    <option value="all">Todas las Zonas</option>
                </select>
            </div>
        </div>

        <div class="bg-white shadow-md rounded-xl overflow-hidden">
            <div class="p-4 flex justify-between items-center border-b">
                 <p id="results-count" class="text-gray-600"></p>
                 <div class="flex items-center space-x-2">
                    <label for="rows-per-page" class="text-sm">Filas:</label>
                    <select id="rows-per-page" class="p-1 border border-gray-300 rounded-lg">
                        <option value="10">10</option>
                        <option value="25" selected>25</option>
                        <option value="50">50</option>
                        <option value="100">100</option>
                    </select>
                </div>
            </div>
            <div class="overflow-x-auto">
                <table class="w-full text-sm text-left">
                    <thead class="bg-gray-50 text-xs text-gray-700 uppercase">
                        <tr>
                            <th class="p-4 sortable" data-column="Denominacion">Denominación</th>
                            <th class="p-4 sortable" data-column="Municipio">Municipio</th>
                            <th class="p-4 sortable" data-column="Isla">Isla</th>
                            <th class="p-4 sortable" data-column="distancia_aeropuerto_km">Distancia Aerop.</th>
                            <th class="p-4">Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="table-body">
                        <!-- Filas de datos generadas por JS -->
                    </tbody>
                </table>
            </div>
            <div id="pagination-controls" class="p-4 flex justify-center items-center space-x-4">
                <!-- Controles de paginación generados por JS -->
            </div>
        </div>
    </div>
    
    <!-- Modal para detalles del centro -->
    <div id="modal" class="fixed inset-0 z-50 hidden items-center justify-center transition-opacity duration-300">
        <div id="modal-backdrop" class="fixed inset-0 bg-black opacity-50"></div>
        <div id="modal-content" class="bg-white rounded-lg shadow-2xl z-10 w-11/12 md:w-1/2 max-w-2xl transform transition-all duration-300 scale-95 opacity-0">
            <div class="p-6 border-b flex justify-between items-center">
                <h2 id="modal-title" class="text-2xl font-bold text-gray-800"></h2>
                <button id="modal-close-btn" class="text-gray-500 hover:text-gray-800 text-3xl">&times;</button>
            </div>
            <div id="modal-body" class="p-6 space-y-4">
                <!-- Detalles del centro generados por JS -->
            </div>
        </div>
    </div>
    
    <footer class="text-center py-4 mt-8">
        <p class="text-sm text-gray-500">Creado por Daniel Tabuyo de las Peñas</p>
    </footer>

    <script>
    document.addEventListener('DOMContentLoaded', () => {

        // --- INICIO DE LA BASE DE DATOS DE CENTROS ---
        const schoolData = [
            {"Codigo": "38000135", "Denominacion": "CEIP ALAJERÓ", "Municipio": "ALAJERÓ", "Direccion": "C/ COLUMBA, S/N", "Telefono": "922-592125", "CorreoElectronico": "38000135@gobiernodecanarias.org", "Isla": "LA GOMERA", "Naturaleza": "Público", "Zona": "Sur", "distancia_aeropuerto_km": 3, "aeropuerto": "GMZ"},
            {"Codigo": "38005054", "Denominacion": "CEIP ANSELMO PÉREZ BRITO", "Municipio": "SANTA CRUZ DE LA PALMA", "Direccion": "C/ EL GALEÓN", "Telefono": "922-592281", "CorreoElectronico": "38005054@gobiernodecanarias.org", "Isla": "LA PALMA", "Naturaleza": "Público", "Zona": "Este", "distancia_aeropuerto_km": 7, "aeropuerto": "SPC"},
            {"Codigo": "38008006", "Denominacion": "CEIP EL MOCANAL", "Municipio": "VALVERDE", "Direccion": "C/ BARLOVENTO, 55", "Telefono": "922-478555", "CorreoElectronico": "38008006@gobiernodecanarias.org", "Isla": "EL HIERRO", "Naturaleza": "Público", "Zona": "Noreste", "distancia_aeropuerto_km": 9, "aeropuerto": "VDE"},
            {"Codigo": "35008664", "Denominacion": "CEE PETRA LORENZO", "Municipio": "TELDE", "Direccion": "CRUZ DE JEREZ, 2", "Telefono": "928-599205", "CorreoElectronico": "35008664@gobiernodecanarias.org", "Isla": "GRAN CANARIA", "Naturaleza": "Público", "Zona": "Este", "distancia_aeropuerto_km": 10, "aeropuerto": "LPA"},
            {"Codigo": "38006150", "Denominacion": "IES ANDRÉS BELLO", "Municipio": "SANTA CRUZ DE TENERIFE", "Direccion": "PLAZA DE LOS CANTOS CANARIOS, 1", "Telefono": "922-760088", "CorreoElectronico": "38006150@gobiernodecanarias.org", "Isla": "TENERIFE", "Naturaleza": "Público", "Zona": "Metropolitana", "distancia_aeropuerto_km": 13, "aeropuerto": "TFN"},
            {"Codigo": "38870102", "Denominacion": "AEOI ADEJE", "Municipio": "ADEJE", "Direccion": "C/ LA CRUZ, 45", "Telefono": "922-592096", "CorreoElectronico": "38011169@gobiernodecanarias.org", "Isla": "TENERIFE", "Naturaleza": "Público", "Zona": "Sur", "distancia_aeropuerto_km": 25, "aeropuerto": "TFS"},
            {"Codigo": "38009311", "Denominacion": "CEE CHACONA", "Municipio": "GÜÍMAR", "Direccion": "C/ HONDURAS, 55", "Telefono": "922-760288", "CorreoElectronico": "38009311@gobiernodecanarias.org", "Isla": "TENERIFE", "Naturaleza": "Público", "Zona": "Sureste", "distancia_aeropuerto_km": 29, "aeropuerto": "TFN"},
            {"Codigo": "35810103", "Denominacion": "AEOI CORRALEJO", "Municipio": "LA OLIVA", "Direccion": "C/ PARALELA A AVDA JUAN CARLOS I S/N", "Telefono": "928-530525", "CorreoElectronico": "35009450@gobiernodecanarias.org", "Isla": "FUERTEVENTURA", "Naturaleza": "Público", "Zona": "Norte", "distancia_aeropuerto_km": 38, "aeropuerto": "FUE"},
            {"Codigo": "35008536", "Denominacion": "CEAD FÉLIX PÉREZ PARRILLA", "Municipio": "LAS PALMAS DE GRAN CANARIA", "Direccion": "C/ DOCTOR GARCÍA CASTRILLO, 22", "Telefono": "928-245743", "CorreoElectronico": "35008536@gobiernodecanarias.org", "Isla": "GRAN CANARIA", "Naturaleza": "Público", "Zona": "Metropolitana", "distancia_aeropuerto_km": 23, "aeropuerto": "LPA"},
            {"Codigo": "35014640", "Denominacion": "CIFP CRUZ DE PIEDRA", "Municipio": "LAS PALMAS DE GRAN CANARIA", "Direccion": "CARRETERA GENERAL DEL NORTE, 40,KM 2.", "Telefono": "928-252969", "CorreoElectronico": "35014640@gobiernodecanarias.org", "Isla": "GRAN CANARIA", "Naturaleza": "Público", "Zona": "Metropolitana", "distancia_aeropuerto_km": 28, "aeropuerto": "LPA"},
            {"Codigo": "35003708", "Denominacion": "CEIP AJEI", "Municipio": "SAN BARTOLOMÉ", "Direccion": "C/ CONSTITUCIÓN, 9", "Telefono": "928-303733", "CorreoElectronico": "35003708@gobiernodecanarias.org", "Isla": "LANZAROTE", "Naturaleza": "Público", "Zona": "Centro", "distancia_aeropuerto_km": 10, "aeropuerto": "ACE"}
        ];
        // --- FIN DE LA BASE DE DATOS DE CENTROS ---

        let currentPage = 1;
        let rowsPerPage = 25;
        let filteredData = [...schoolData];
        let sortColumn = 'distancia_aeropuerto_km';
        let sortDirection = 'asc';

        const searchInput = document.getElementById('search-input');
        const filterIsla = document.getElementById('filter-isla');
        const filterMunicipio = document.getElementById('filter-municipio');
        const filterZona = document.getElementById('filter-zona');
        const tableBody = document.getElementById('table-body');
        const paginationControls = document.getElementById('pagination-controls');
        const rowsPerPageSelect = document.getElementById('rows-per-page');
        const resultsCount = document.getElementById('results-count');
        const modal = document.getElementById('modal');
        const modalContent = document.getElementById('modal-content');
        const modalBackdrop = document.getElementById('modal-backdrop');
        const modalCloseBtn = document.getElementById('modal-close-btn');

        function initialize() {
            populateFilters();
            addEventListeners();
            sortData(sortColumn, true); // Sort inicial
        }

        function populateFilters() {
            const islas = [...new Set(schoolData.map(item => item.Isla))].sort();
            islas.forEach(isla => filterIsla.add(new Option(isla, isla)));
        }

        function updateDependentFilters() {
            const selectedIsla = filterIsla.value;
            
            // Reset y poblar municipios
            filterMunicipio.innerHTML = '<option value="all">Todos los Municipios</option>';
            if (selectedIsla !== 'all') {
                filterMunicipio.disabled = false;
                const municipios = [...new Set(schoolData.filter(item => item.Isla === selectedIsla).map(item => item.Municipio))].sort();
                municipios.forEach(m => filterMunicipio.add(new Option(m,m)));
            } else {
                filterMunicipio.disabled = true;
            }

            // Reset y poblar zonas
            filterZona.innerHTML = '<option value="all">Todas las Zonas</option>';
            if (selectedIsla !== 'all') {
                 filterZona.disabled = false;
                 const zonas = [...new Set(schoolData.filter(item => item.Isla === selectedIsla).map(item => item.Zona))].sort();
                 zonas.forEach(z => filterZona.add(new Option(z,z)));
            } else {
                 filterZona.disabled = true;
            }
        }

        function applyAllFilters() {
            const searchTerm = searchInput.value.toLowerCase();
            const selectedIsla = filterIsla.value;
            const selectedMunicipio = filterMunicipio.value;
            const selectedZona = filterZona.value;

            filteredData = schoolData.filter(item => {
                const searchMatch = (item.Denominacion.toLowerCase().includes(searchTerm) || item.Codigo.toLowerCase().includes(searchTerm));
                const islaMatch = (selectedIsla === 'all' || item.Isla === selectedIsla);
                const municipioMatch = (selectedMunicipio === 'all' || item.Municipio === selectedMunicipio);
                const zonaMatch = (selectedZona === 'all' || item.Zona === selectedZona);
                return searchMatch && islaMatch && municipioMatch && zonaMatch;
            });
            
            currentPage = 1;
            sortData(sortColumn, false); // Re-sort but don't toggle direction
        }

        function sortData(column, isInitialSort = false) {
            if (!isInitialSort) {
                if (sortColumn === column) {
                    sortDirection = sortDirection === 'asc' ? 'desc' : 'asc';
                } else {
                    sortColumn = column;
                    sortDirection = 'asc';
                }
            }
            
            filteredData.sort((a, b) => {
                const valA = a[column];
                const valB = b[column];

                if (!isNaN(valA) && !isNaN(valB)) {
                    return sortDirection === 'asc' ? valA - valB : valB - valA;
                }
                
                const strA = String(valA).toLowerCase();
                const strB = String(valB).toLowerCase();

                if (strA < strB) return sortDirection === 'asc' ? -1 : 1;
                if (strA > strB) return sortDirection === 'asc' ? 1 : -1;
                return 0;
            });

            renderTable();
        }

        function renderTable() {
            tableBody.innerHTML = '';
            const start = (currentPage - 1) * rowsPerPage;
            const end = start + rowsPerPage;
            const paginatedData = filteredData.slice(start, end);

            paginatedData.forEach(item => {
                const row = document.createElement('tr');
                row.className = 'bg-white border-b hover:bg-gray-50';
                row.innerHTML = `
                    <td class="p-4 font-medium text-gray-900">${item.Denominacion}</td>
                    <td class="p-4">${item.Municipio} (${item.Zona})</td>
                    <td class="p-4">${item.Isla}</td>
                    <td class="p-4 text-center">${item.distancia_aeropuerto_km} km</td>
                    <td class="p-4">
                        <button class="view-details-btn font-medium text-blue-600 hover:underline" data-id="${item.Codigo}">Ver Detalles</button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
            
            updateResultsCount();
            renderPagination();
            updateSortHeaders();
        }
        
        function updateResultsCount() {
            resultsCount.textContent = `Mostrando ${filteredData.length} de ${schoolData.length} resultados.`;
        }

        function renderPagination() {
            paginationControls.innerHTML = '';
            const totalPages = Math.ceil(filteredData.length / rowsPerPage);

            if (totalPages <= 1) return;

            const prevButton = document.createElement('button');
            prevButton.textContent = 'Anterior';
            prevButton.disabled = currentPage === 1;
            prevButton.className = 'px-3 py-1 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed bg-gray-200 hover:bg-gray-300';
            prevButton.addEventListener('click', () => { currentPage--; renderTable(); });
            paginationControls.appendChild(prevButton);

            const pageIndicator = document.createElement('span');
            pageIndicator.textContent = `Página ${currentPage} de ${totalPages}`;
            pageIndicator.className = 'text-sm text-gray-700';
            paginationControls.appendChild(pageIndicator);
            
            const nextButton = document.createElement('button');
            nextButton.textContent = 'Siguiente';
            nextButton.disabled = currentPage === totalPages;
            nextButton.className = 'px-3 py-1 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed bg-gray-200 hover:bg-gray-300';
            nextButton.addEventListener('click', () => { currentPage++; renderTable(); });
            paginationControls.appendChild(nextButton);
        }
        
        function updateSortHeaders() {
            document.querySelectorAll('.sortable').forEach(header => {
                header.classList.remove('sort-asc', 'sort-desc');
                if (header.dataset.column === sortColumn) {
                    header.classList.add(sortDirection === 'asc' ? 'sort-asc' : 'sort-desc');
                }
            });
        }
        
        function showModal(codigo) {
            const center = schoolData.find(c => c.Codigo === codigo);
            if (!center) return;

            document.getElementById('modal-title').textContent = center.Denominacion;
            document.getElementById('modal-body').innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-gray-700">
                    <p><strong>Código:</strong> ${center.Codigo}</p>
                    <p><strong>Naturaleza:</strong> ${center.Naturaleza}</p>
                    <p><strong>Isla:</strong> ${center.Isla}</p>
                    <p><strong>Zona:</strong> ${center.Zona || 'N/D'}</p>
                    <p class="md:col-span-2"><strong>Municipio:</strong> ${center.Municipio}</p>
                    <p class="md:col-span-2"><strong>Dirección:</strong> ${center.Direccion}</p>
                    <p><strong>Teléfono:</strong> ${center.Telefono || 'No disponible'}</p>
                    <p><strong>Email:</strong> ${center.CorreoElectronico || 'No disponible'}</p>
                    <p class="md:col-span-2"><strong>Aeropuerto cercano:</strong> ${center.aeropuerto || 'N/D'} (~${center.distancia_aeropuerto_km || '?'} km)</p>
                </div>
                <div class="mt-6 flex flex-wrap gap-2">
                    <button onclick="copyToClipboard('${center.Telefono}')" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded">Copiar Teléfono</button>
                    <button onclick="copyToClipboard('${center.CorreoElectronico}')" class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded">Copiar Email</button>
                    <a href="https://www.google.com/maps?q=${encodeURIComponent(center.Direccion + ', ' + center.Municipio)}" target="_blank" class="bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-2 px-4 rounded">Ver en Mapa</a>
                </div>
            `;
            
            modal.classList.remove('hidden');
            modalContent.classList.remove('opacity-0', 'scale-95');
        }
        
        function hideModal() {
            modalContent.classList.add('opacity-0', 'scale-95');
            setTimeout(() => modal.classList.add('hidden'), 200);
        }

        function addEventListeners() {
            searchInput.addEventListener('input', applyAllFilters);
            filterIsla.addEventListener('change', () => {
                updateDependentFilters();
                applyAllFilters();
            });
            filterMunicipio.addEventListener('change', applyAllFilters);
            filterZona.addEventListener('change', applyAllFilters);

            rowsPerPageSelect.addEventListener('change', (e) => {
                rowsPerPage = parseInt(e.target.value, 10);
                currentPage = 1;
                renderTable();
            });
            document.querySelectorAll('.sortable').forEach(header => {
                header.addEventListener('click', () => sortData(header.dataset.column));
            });
            tableBody.addEventListener('click', (e) => {
                const button = e.target.closest('.view-details-btn');
                if (button) {
                    showModal(button.dataset.id);
                }
            });
            modalCloseBtn.addEventListener('click', hideModal);
            modalBackdrop.addEventListener('click', hideModal);
        }
        
        initialize();
    });
    
    // Función global para copiar al portapapeles
    function copyToClipboard(text) {
        if (!text || text === 'No disponible') {
            alert('No hay información para copiar.');
            return;
        }
        
        const tempInput = document.createElement('input');
        tempInput.value = text;
        document.body.appendChild(tempInput);
        tempInput.select();
        try {
            document.execCommand('copy');
            alert('¡Copiado al portapapeles!');
        } catch (err) {
            console.error('Error al copiar: ', err);
            alert('No se pudo copiar.');
        }
        document.body.removeChild(tempInput);
    }
    </script>
</body>
</html>
